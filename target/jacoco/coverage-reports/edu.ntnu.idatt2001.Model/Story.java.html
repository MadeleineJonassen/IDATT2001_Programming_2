<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="no"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Story.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">paths</a> &gt; <a href="index.source.html" class="el_package">edu.ntnu.idatt2001.Model</a> &gt; <span class="el_source">Story.java</span></div><h1>Story.java</h1><pre class="source lang-java linenums">package edu.ntnu.idatt2001.Model;
import java.util.*;

public class Story {
  private final String title;
<span class="fc" id="L6">  private Map&lt;Link, Passage&gt; passages = new HashMap&lt;&gt;();</span>
  private final Passage openingPassage;
  
  
  //constructor, initializes a story object with title and opening passage
<span class="fc" id="L11">  public Story(String title, Passage openingPassage) {</span>
<span class="fc bfc" id="L12" title="All 2 branches covered.">    if(title.isEmpty()){</span>
<span class="fc" id="L13">      throw new IllegalArgumentException(&quot;Title cannot be empty&quot;);</span>
    }
<span class="fc" id="L15">    this.title = title;</span>
<span class="fc" id="L16">    this.openingPassage = openingPassage;</span>
<span class="fc" id="L17">    Link openingLink = new Link(&quot;Play story&quot;, openingPassage.getTitle());</span>
<span class="fc" id="L18">    passages.put(openingLink, openingPassage);</span>
<span class="fc" id="L19">  }</span>
  
  public String getTitle() {
<span class="fc" id="L22">    return title;</span>
  }
  
  public Passage getOpeningPassage() {
    //return deep copy?
<span class="fc" id="L27">    return openingPassage;</span>
  }
  
  //Adds a new passage to the story-list
  //Constructs a custom Link-object to use as key in hashMap
  public void addPassage(Passage passage){
    //if passage is not linked to? 'Unreachable' passages.
    //get broken links, see link references, or create link, use .equals-method
    
<span class="fc bfc" id="L36" title="All 2 branches covered.">    if(passages.containsValue(passage)){</span>
<span class="fc" id="L37">      throw new IllegalArgumentException(&quot;This passage had already been added to the story&quot;);</span>
    }
    
    
<span class="fc" id="L41">    String passageTitle = passage.getTitle();</span>
    
<span class="fc" id="L43">    passages.put(new Link(passageTitle, passageTitle), passage);</span>
    
    /*
    for(Passage listedPassage : getPassages()){
      for(Link link : listedPassage.getLinks()){
        if(link.getReference().equals(passageTitle)){
          passages.put(link,passage);
        }
      }
    }*/
<span class="fc" id="L53">  }</span>
  
  //Returns a passage, specified by the Link-object parameter
  public Passage getPassage(Link link){
<span class="fc bfc" id="L57" title="All 2 branches covered.">    if(!passages.containsKey(link)){</span>
<span class="fc" id="L58">      throw new IllegalArgumentException(&quot;No such link in the story.&quot;);</span>
    }
    //return deep copy?
<span class="fc" id="L61">    return passages.get(link);</span>
  }
  
  //Returns a list of all the passages currently contained in the story
  public Collection&lt;Passage&gt; getPassages() {
<span class="fc" id="L66">    HashSet&lt;Passage&gt; passageHashSet = new HashSet&lt;&gt;(passages.size());</span>
<span class="fc bfc" id="L67" title="All 2 branches covered.">    for(Link link : passages.keySet()){</span>
<span class="fc" id="L68">      passageHashSet.add(passages.get(link));</span>
<span class="fc" id="L69">    }</span>
    //return deep copied list?
    
<span class="fc" id="L72">    return passageHashSet;</span>
  }
  
  public List&lt;Link&gt; getBrokenLinks(){
    /*
    List&lt;Link&gt; brokenLinks = new ArrayList&lt;&gt;();
    //use streams
    for(Passage listedPassage : getPassages()){
      for(Link link : listedPassage.getLinks()){
        if (passages.containsKey(link)){
          brokenLinks.add(link);
        }
      }
    }*/
    
<span class="fc bfc" id="L87" title="All 2 branches covered.">    List&lt;Link&gt; brokenLinks = passages.values().stream().map(Passage::getLinks).flatMap(Collection::stream).filter(link -&gt; !passages.containsKey(link)).toList();</span>
    
    
<span class="fc" id="L90">    return brokenLinks;</span>
  }
  
  public void deleteBrokenLinks(){
<span class="fc bfc" id="L94" title="All 2 branches covered.">    for(Link l : getBrokenLinks()){</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">      for (Passage p : getPassages()){</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">        if(p.getLinks().contains(l)){</span>
<span class="fc" id="L97">          p.removeLink(l);</span>
        }
<span class="fc" id="L99">      }</span>
<span class="fc" id="L100">    }</span>
    
<span class="fc" id="L102">  }</span>
  
  //removes a passage from the story
  public void removePassage(Link link){
<span class="fc bfc" id="L106" title="All 2 branches covered.">    if(!passages.containsKey(link)){</span>
<span class="fc" id="L107">      throw new IllegalArgumentException(&quot;No such link in the story.&quot;);</span>
    }
    //TODO: restrict, passages cannot be removed if linked to (creating broken links)
    //not supposed to be able to remove passage if other passages contain a link leading to the passage.
    //Should it instead be the other way around? If a passage links to other passages it would create
    //passages that cannot be accessed
    //if not: need a way to replace passage or remove links!
<span class="fc" id="L114">    passages.remove(link);</span>
<span class="fc" id="L115">  }</span>
  
  @Override
  public boolean equals(Object obj) {
<span class="fc bfc" id="L119" title="All 2 branches covered.">    if (this == obj) return true;</span>
<span class="pc bpc" id="L120" title="2 of 4 branches missed.">    if(obj == null || getClass() != obj.getClass()) return false;</span>
    
<span class="fc" id="L122">    Story s = (Story) obj;</span>
<span class="pc bpc" id="L123" title="1 of 4 branches missed.">    return (s.getTitle().equals(this.title) &amp;&amp; s.getPassages().equals(getPassages()));</span>
  }
  
  
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>