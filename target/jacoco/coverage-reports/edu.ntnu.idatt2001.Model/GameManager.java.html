<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="no"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">paths</a> &gt; <a href="index.source.html" class="el_package">edu.ntnu.idatt2001.Model</a> &gt; <span class="el_source">GameManager.java</span></div><h1>GameManager.java</h1><pre class="source lang-java linenums">package edu.ntnu.idatt2001.Model;

import edu.ntnu.idatt2001.Goal.Goal;
import edu.ntnu.idatt2001.Goal.InventoryGoal;
import edu.ntnu.idatt2001.Players.Player;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;

import java.util.*;
import java.util.stream.Collectors;

<span class="nc" id="L12">public class GameManager {</span>
  private Game game;
  private PlayGameModel startedGame;
  private Story story;
  private Player player;
<span class="nc" id="L17">  private ObservableList&lt;Goal&gt; goalsList = FXCollections.observableList(new ArrayList&lt;&gt;());</span>
<span class="nc" id="L18">  private ObservableList&lt;Goal&gt; completedGoalsList = FXCollections.observableList(new ArrayList&lt;&gt;());</span>
<span class="nc" id="L19">  private ObservableList&lt;Goal&gt; nonCompletedGoalsList = FXCollections.observableList(new ArrayList&lt;&gt;());</span>
<span class="nc" id="L20">  private ObservableList&lt;String&gt; playerList = FXCollections.observableList(new ArrayList&lt;&gt;());</span>
  
  public void setStory(Story story){
    //TODO: check for broken links
<span class="nc" id="L24">    this.story = story;</span>
<span class="nc" id="L25">  }</span>
  
  public void setPlayer(Player player){
<span class="nc" id="L28">    this.player = player;</span>
<span class="nc" id="L29">    playerList.clear();</span>
<span class="nc" id="L30">    playerList.addAll(player.getName(),</span>
<span class="nc" id="L31">            Integer.toString(player.getHealth()),</span>
<span class="nc" id="L32">            Integer.toString(player.getGold()),</span>
<span class="nc" id="L33">            Integer.toString(player.getScore()),</span>
<span class="nc" id="L34">            player.getInventory().toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;));</span>
<span class="nc" id="L35">  }</span>
  
  public void addGoal(Goal goal){
<span class="nc bnc" id="L38" title="All 2 branches missed.">    if(goalsList.contains(goal)){</span>
<span class="nc" id="L39">      throw new IllegalArgumentException(&quot;Goal has already been added.&quot;);</span>
    }
<span class="nc" id="L41">    goalsList.add(goal);</span>
<span class="nc" id="L42">  }</span>
  
  public ObservableList&lt;Goal&gt; getGoals(){
<span class="nc" id="L45">    return goalsList;</span>
  }
  
  public ObservableList&lt;Goal&gt; getNonCompletedGoals(){
<span class="nc" id="L49">    return nonCompletedGoalsList;</span>
  }
  
  public ObservableList&lt;Goal&gt; getCompletedGoals(){
<span class="nc" id="L53">    return completedGoalsList;</span>
  }
  
  public ObservableList&lt;String&gt; getPlayerInfo(){
<span class="nc" id="L57">    return playerList;</span>
  }
  
  public void clearGoals(){
<span class="nc" id="L61">    goalsList.clear();</span>
<span class="nc" id="L62">  }</span>
  
  public boolean storyHasBeenAdded(){
<span class="nc bnc" id="L65" title="All 2 branches missed.">    return !(story == null);</span>
  }
  
  public boolean playerHasBeenAdded(){
<span class="nc bnc" id="L69" title="All 2 branches missed.">    return !(player == null);</span>
  }
  
  public void createGame(){
    //This method is run when user clicks &quot;run game&quot;-button
<span class="nc bnc" id="L74" title="All 2 branches missed.">    if(this.story == null){</span>
<span class="nc" id="L75">      throw new NullPointerException(&quot;Story has not been added&quot;);</span>
    }
<span class="nc bnc" id="L77" title="All 2 branches missed.">    if(this.player == null){</span>
<span class="nc" id="L78">      throw new NullPointerException(&quot;Player has not been added&quot;);</span>
    }
<span class="nc bnc" id="L80" title="All 2 branches missed.">    if(this.goalsList.isEmpty()){</span>
<span class="nc" id="L81">      throw new NullPointerException(&quot;Goals have not been added&quot;);</span>
    }
<span class="nc" id="L83">    this.game = new Game(this.player, this.story, this.goalsList.stream().toList());</span>
<span class="nc" id="L84">  }</span>
  
  public Game getGame(){
    //TODO: return deep copy????
    //method might not be needed, as the class provides relevant getters and
    //Game is only created when story, player etc is finished, so method might be nice for playGame-scene?
<span class="nc bnc" id="L90" title="All 2 branches missed.">    if (this.game == null){</span>
<span class="nc" id="L91">      return null;</span>
    }
    
<span class="nc" id="L94">    return new Game(game);</span>
  }
  
  public void setGameInProgress(PlayGameModel gameInProgress){
<span class="nc" id="L98">    this.startedGame = gameInProgress;</span>
<span class="nc" id="L99">  }</span>
  
  public PlayGameModel getGameInProgress(){
<span class="nc" id="L102">    return startedGame;</span>
  }
  
  public String getPlayerName(){
<span class="nc bnc" id="L106" title="All 2 branches missed.">    if(this.player == null){</span>
<span class="nc" id="L107">      throw new IllegalArgumentException(&quot;The player is not defined&quot;);</span>
    }
<span class="nc" id="L109">    return player.getName();</span>
  }
  
  public Player getPlayer(){
<span class="nc bnc" id="L113" title="All 2 branches missed.">    if(player == null){</span>
<span class="nc" id="L114">      throw new IllegalArgumentException(&quot;Player has not been added.&quot;);</span>
    }
<span class="nc" id="L116">    return player;</span>
  }
  
  public List&lt;String&gt; getBrokenLinks(){
<span class="nc bnc" id="L120" title="All 2 branches missed.">    if(this.story == null){</span>
<span class="nc" id="L121">      throw new IllegalArgumentException(&quot;The story is not defined&quot;);</span>
    }
    
<span class="nc" id="L124">    List&lt;Link&gt; links = this.story.getBrokenLinks();</span>
    
<span class="nc" id="L126">    List&lt;String&gt; linkNames = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">    for(Link l : links){</span>
<span class="nc" id="L128">      linkNames.add(l.getText());</span>
<span class="nc" id="L129">    }</span>
<span class="nc" id="L130">    return linkNames;</span>
  }
  
  public void deleteBrokenLinks(){
<span class="nc" id="L134">    story.deleteBrokenLinks();</span>
<span class="nc" id="L135">  }</span>
  
  public String getStoryTitle(){
<span class="nc bnc" id="L138" title="All 2 branches missed.">    if (this.story == null){</span>
<span class="nc" id="L139">      throw new NullPointerException(&quot;Story must be added first&quot;);</span>
    }
<span class="nc" id="L141">    return story.getTitle();</span>
  }
  
  private Collection&lt;Passage&gt; getStoryPassages(){
<span class="nc bnc" id="L145" title="All 2 branches missed.">    if (this.story == null){</span>
<span class="nc" id="L146">      throw new NullPointerException(&quot;Story must be added first&quot;);</span>
    }
    
<span class="nc" id="L149">    Collection&lt;Passage&gt; passages = this.story.getPassages();</span>
    
<span class="nc" id="L151">    return passages;</span>
  }
  
  public Set&lt;String&gt; getStoryPassageNames(){
<span class="nc" id="L155">    return getStoryPassages().stream().map(Passage::getTitle).collect(Collectors.toSet());</span>
  }
  
  public Passage getOpeningPassage(){
<span class="nc bnc" id="L159" title="All 2 branches missed.">    if (this.game == null){</span>
<span class="nc" id="L160">      throw new NullPointerException(&quot;The game has not been created&quot;);</span>
    }
<span class="nc" id="L162">    return this.game.getStory().getOpeningPassage();</span>
  }
  
  public Passage nextPassage(Link link){
<span class="nc bnc" id="L166" title="All 2 branches missed.">    if (this.game == null){</span>
<span class="nc" id="L167">      throw new NullPointerException(&quot;The game has not been created&quot;);</span>
    }
<span class="nc" id="L169">    Passage newPassage = this.game.go(link);</span>
    //checkGoalCompletion();
<span class="nc" id="L171">    return newPassage;</span>
  }
  
  private void checkGoalCompletion(){
<span class="nc bnc" id="L175" title="All 2 branches missed.">    for(Goal g : nonCompletedGoalsList){</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">      if(g.isFulfilled(this.game.getPlayer())){</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">        if(nonCompletedGoalsList.size()&gt;1){</span>
<span class="nc" id="L178">          nonCompletedGoalsList.remove(g);</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">        } else if(nonCompletedGoalsList.size() == 1) {</span>
<span class="nc" id="L180">          System.out.println(nonCompletedGoalsList);</span>
<span class="nc" id="L181">          nonCompletedGoalsList.clear();</span>
<span class="nc" id="L182">          System.out.println(nonCompletedGoalsList);</span>
        }
        
        //List&lt;String&gt; placeHolder = new ArrayList&lt;&gt;();
        //placeHolder.add(&quot;Placeholder&quot;);
        //nonCompletedGoalsList.add(new InventoryGoal(placeHolder));
        //completedGoalsList.add(g);
      }
<span class="nc" id="L190">    }</span>
<span class="nc" id="L191">  }</span>
  
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>